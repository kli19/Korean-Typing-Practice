{% extends "base.html" %}

{% block title %}
  Typing Practice
{% endblock %}

{% block nav %}
<li class="nav-item">
  <a class="nav-link" aria-current="page" href="/keyboard">Keyboard</a>
</li>
<li class="nav-item">
  <a class="nav-link active" aria-current="page" href="/lessons">Lessons</a>
</li>
{% endblock %}

{% block content %}
<div class="container-fluid p-1">
  <div class="row p-1 mx"> 
      <h3 class="text-center"> {{text["title_kor"]}} </h3>
  </div>
  <div class="row p-1 mx"> 
    <div class="col-7 mx-auto">
        <!-- <span style="white-space: pre-line"> {{text["text"]}} </span> -->
        {% for line in text["text"] %}
        <p id="{{loop.index-1}}"> {{line}} </p>
        {% endfor %}
    </div>
  </div>
  <div class="row p-1 mx"> 
    <form class="row g-3">
    <div class="col-7 mx-auto"> 
        <div class="form-group">
          <input id="user_input" type="text" class="form-control">
          </div>
    </div>
    </form>
  </div>
  <br>
  <div id="keyboard">
    <div class="row p-1">
      <div class="d-grid gap-2 d-md-flex justify-content-md-center">
        <button type="button" class="btn btn-outline-secondary btn-lg" id="Backquote"> ~ <br> ` </button>
        <button type="button" class="btn btn-outline-secondary btn-lg" id="Digit1"> ! <br> 1 </button>
        <button type="button" class="btn btn-outline-secondary btn-lg" id="Digit2"> @ <br> 2 </button>
        <button type="button" class="btn btn-outline-secondary btn-lg" id="Digit3"> # <br> 3 </button>
        <button type="button" class="btn btn-outline-secondary btn-lg" id="Digit4"> $ <br> 4 </button>
        <button type="button" class="btn btn-outline-secondary btn-lg" id="Digit5"> % <br> 5 </button>
        <button type="button" class="btn btn-outline-secondary btn-lg" id="Digit6"> ^ <br> 6 </button>
        <button type="button" class="btn btn-outline-secondary btn-lg" id="Digit7"> & <br> 7 </button>
        <button type="button" class="btn btn-outline-secondary btn-lg" id="Digit8"> * <br> 8 </button>
        <button type="button" class="btn btn-outline-secondary btn-lg" id="Digit9"> ( <br> 9 </button>
        <button type="button" class="btn btn-outline-secondary btn-lg" id="Digit0"> ) <br> 0 </button>
        <button type="button" class="btn btn-outline-secondary btn-lg" id="Minus"> _ <br> - </button>
        <button type="button" class="btn btn-outline-secondary btn-lg" id="Equal"> + <br> = </button>
        <button type="button" class="btn btn-outline-secondary btn-lg" id="Backspace"> backspace </button>
      </div>
    </div>
    <div class="row p-1">
      <div class="d-grid gap-2 d-md-flex justify-content-md-center">
        <!-- <button type="button" class="btn btn-outline-secondary btn-lg" id="Tab"> tab </button> -->
        <button type="button" class="btn btn-outline-secondary btn-lg" id="KeyQ"> q ㅃ <br> ㅂ </button>
        <button type="button" class="btn btn-outline-secondary btn-lg" id="KeyW"> w ㅉ <br> ㅈ </button>
        <button type="button" class="btn btn-outline-secondary btn-lg" id="KeyE"> e ㄸ <br> ㄷ </button>
        <button type="button" class="btn btn-outline-secondary btn-lg" id="KeyR"> r ㄲ <br> ㄱ </button>
        <button type="button" class="btn btn-outline-secondary btn-lg" id="KeyT"> t ㅆ <br> ㅅ </button>
        <button type="button" class="btn btn-outline-secondary btn-lg" id="KeyY"> y <br> ㅛ </button>
        <button type="button" class="btn btn-outline-secondary btn-lg" id="KeyU"> u <br> ㅕ </button>
        <button type="button" class="btn btn-outline-secondary btn-lg" id="KeyI"> i <br> ㅑ </button>
        <button type="button" class="btn btn-outline-secondary btn-lg" id="KeyO"> o ㅒ <br> ㅐ </button>
        <button type="button" class="btn btn-outline-secondary btn-lg" id="KeyP"> p ㅖ <br> ㅔ </button>
        <button type="button" class="btn btn-outline-secondary btn-lg" id="BracketLeft"> { <br> [ </button>
        <button type="button" class="btn btn-outline-secondary btn-lg" id="BracketRight"> } <br> ] </button>
        <button type="button" class="btn btn-outline-secondary btn-lg" id="Backslash"> | <br> \ </button>
      </div>
    </div>
    <div class="row p-1">
      <div class="d-grid gap-2 d-md-flex justify-content-md-center">
        <button type="button" class="btn btn-outline-secondary btn-lg" id="CapsLock"> caps lock </button>
        <button type="button" class="btn btn-outline-secondary btn-lg" id="KeyA"> a <br> ㅁ </button>
        <button type="button" class="btn btn-outline-secondary btn-lg" id="KeyS"> s <br> ㄴ </button>
        <button type="button" class="btn btn-outline-secondary btn-lg" id="KeyD"> d <br> ㅇ </button>
        <button type="button" class="btn btn-outline-secondary btn-lg" id="KeyF"> f <br> ㄹ </button>
        <button type="button" class="btn btn-outline-secondary btn-lg" id="KeyG"> g <br> ㅎ </button>
        <button type="button" class="btn btn-outline-secondary btn-lg" id="KeyH"> h <br> ㅗ </button>
        <button type="button" class="btn btn-outline-secondary btn-lg" id="KeyJ"> j <br> ㅓ </button>
        <button type="button" class="btn btn-outline-secondary btn-lg" id="KeyK"> k <br> ㅏ </button>
        <button type="button" class="btn btn-outline-secondary btn-lg" id="KeyL"> l <br> ㅣ </button>
        <button type="button" class="btn btn-outline-secondary btn-lg" id="Semicolon"> : <br> ; </button>
        <button type="button" class="btn btn-outline-secondary btn-lg" id="Quote"> " <br> ' </button>
        <button type="button" class="btn btn-outline-secondary btn-lg" id="Enter"> enter </button>
      </div>
    </div>
    <div class="row p-1">
      <div class="d-grid gap-2 d-md-flex justify-content-md-center">
        <button type="button" class="btn btn-outline-secondary btn-lg" id="ShiftLeft"> shift </button>
        <button type="button" class="btn btn-outline-secondary btn-lg" id="KeyZ"> z <br> ㅋ </button>
        <button type="button" class="btn btn-outline-secondary btn-lg" id="KeyX"> x <br> ㅌ </button>
        <button type="button" class="btn btn-outline-secondary btn-lg" id="KeyC"> c <br> ㅊ </button>
        <button type="button" class="btn btn-outline-secondary btn-lg" id="KeyV"> v <br> ㅍ </button>
        <button type="button" class="btn btn-outline-secondary btn-lg" id="KeyB"> b <br> ㅠ </button>
        <button type="button" class="btn btn-outline-secondary btn-lg" id="KeyN"> n <br> ㅜ </button>
        <button type="button" class="btn btn-outline-secondary btn-lg" id="KeyM"> m <br> ㅡ </button>
        <button type="button" class="btn btn-outline-secondary btn-lg" id="Comma"> < <br> , </button>
        <button type="button" class="btn btn-outline-secondary btn-lg" id="Period"> > <br> . </button>
        <button type="button" class="btn btn-outline-secondary btn-lg" id="Slash"> ? <br> / </button>
        <button type="button" class="btn btn-outline-secondary btn-lg" id="ShiftRight"> shift </button>
      </div>
    </div>
    <div class="row p-1">
        <div class="d-grid gap-2 col-5 mx-auto">
          <button class="btn btn-outline-secondary btn-lg" type="button" id="Space"> &nbsp </button>
      </div>
    </div>
    </div>

</div>
{% endblock %}

{% block script %}
 <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
 <script>
  'use strict';

  var text = {{text["text"] | safe}};
  var curr = 0;
  let check_line = function (event) {
    if (event.key == "Enter"){
      event.preventDefault();
      console.log(text.length)
      if (curr < text.length) {
        let user_input = document.getElementById("user_input").value.trim();
        let curr_line = document.getElementById(curr.toString());
        // console.log(user_input);
        // console.log(curr_line.textContent.trim());
        if (user_input == curr_line.textContent.trim()) {
          curr_line.style.backgroundColor = "#00FF00";
        } else{
          curr_line.style.backgroundColor = "#AA4A44";
        }
        curr += 1;
      }
    }
  }


   const keys = ["Digit0", "Digit1", "Digit2", "Digit3", "Digit4", "Digit5", "Digit6", "Digit7", "Digit8", "Digit9",
   "KeyA", "KeyB", "KeyC", "KeyD", "KeyE", "KeyF", "KeyG", "KeyH", "KeyI", "KeyJ", "KeyK", "KeyL", "KeyM", "KeyN",
   "KeyO", "KeyP", "KeyQ", "KeyR", "KeyS", "KeyT", "KeyU", "KeyV", "KeyW", "KeyX", "KeyY", "KeyZ",
   "Backquote", "Minus", "Equal", "Backspace", "BracketLeft", "BracketRight", "Backslash", "CapsLock", "Semicolon", "Quote", "Enter", "ShiftLeft", "Comma", "Period", "Slash", "ShiftRight", "Space"];
   let highlight = function (event) {
     if (!event.metaKey && !event.ctrlKey && keys.includes(event.code)) {
       document.getElementById(event.code).className = "btn btn-secondary btn-lg";
    }
   }

   let unhighlight = function (event) {
     if (!event.metaKey && !event.ctrlKey && keys.includes(event.code)) {
       document.getElementById(event.code).className = "btn btn-outline-secondary btn-lg";
     }
   }

   // set up event listeners to highlight corresponding button on keypress
   const input = document.querySelector('input');
   input.addEventListener("keydown", highlight);
   input.addEventListener("keyup", unhighlight);
   input.addEventListener("keypress", check_line)
   </script>

{% endblock %}